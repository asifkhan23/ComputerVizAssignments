---
title: "HW 4 - IE 6600 - Sec 03 - Team 5"
author: "Kirti Aggarwal"
date: "2/19/2021"
output: pdf_document
---

```{r}
# Set the R environment to your current directory
#setwd("/Users/kirtiagwl1595/Desktop/Computation and Data Visualisation/Assignment/Assignment 4")
setwd("/Users/asif/NEU/IE-6600 - Comp Viz/Assignment/ComputerVizAssignments/HW4")
```

## Packages to be installed
```{r}
install.packages("ggalluvial")
```


```{r}
# Adding the required R packages
library(tidyverse)
library(lubridate)
library(corrplot)
library(gridExtra)
library(scales)
library(reshape2)
library(magrittr)
library(tidyr)
library(ggplot2)
library(dplyr)
library(corrr)
library(ggalluvial)
```

```{r}
# Adding datasets to R
ad.df <- read_csv("airlines_delay.csv")
wage.df <- read_csv("wages_jobs.csv")
opt.df <- read_csv("occupations.csv")
```

library(magrittr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(dplyr)


```{r}
df_air_1 <- ad.df %>% 
    select(carrier_delay, late_aircraft_delay, nas_delay, security_delay, weather_delay) %>% 
    drop_na()
delay_long <- gather(df_air_1)
PlotFunc<- function(DF)
{
  p<-ggplot(DF, aes(x =value, fill=key)) +
    geom_density(alpha=0.5) +
    scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
                  labels = trans_format("log10", math_format(10^.x))) + 
    ggtitle("Density plot of carrier delays in mins") + 
    xlab("log delay in mins") + 
    ylab("Density")
p
}
PlotFunc(delay_long)                                       
```

```{r}
df1 <- ad.df %>% 
  select(7:16) %>% 
  drop_na()
M <- cor(df1)
corrplot.mixed(M,lower="number",upper="circle",lower.col="black",tl.pos="d",number.cex=0.6,tl.cex=0.65,)


```

```{r}
task5 <- wage.df %>% 
  filter(Year == 2018) %>% 
  group_by(`ID PUMS Occupation`)
  
ggplot(task5, aes(x=`PUMS Occupation`, y=`Average Wage`, fill=Gender)) +
  geom_bar()

```

## Task 3
### From wages_jobs.csv generate a heat map as shown below. The variable Difference is defined as the difference between number of male employees and the number of female employees. A negative value indicate more number of female than male employees. In addition to the plot critique the below visualization:

### • Transform the x axis using a log10 to better visualize the data spread.

```{r}

wage.df %>% 
  filter(Gender == "Female") %>% 
  summarise(noOfFemales = n())

wage.df %>% 
  filter(Gender == "Male") %>% 
  summarise(noOfMales = n())

ggplot(data = as.data.frame(wage.df), aes(x=Year, y=`PUMS Occupation`, fill = Gender)) + 
        geom_tile()

```

## Task 4
### From wages_jobs.csv generate the following alluvial chart.
### • Read documentation of geom_alluvial and geom_stratum to solve this task

```{r}
ggplot(as.data.frame(wage.df), aes(y =`Total Population`, axis1 = `PUMS Occupation`, axis2 = Year)) +
  geom_alluvium(aes(fill = Gender), width = 1/12) +
  geom_stratum(width = 1/4) +
  scale_x_discrete(limits = c("Occupation", "Gender"), expand = c(.1, 0)) +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  theme_minimal()
```

